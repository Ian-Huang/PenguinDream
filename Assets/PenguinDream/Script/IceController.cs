using UnityEngine;
using System.Collections;

/// <summary>
/// 控制浮冰的移動(左右)、以及浮冰的漂浮(上下)
/// </summary>
public class IceController : MonoBehaviour
{
    public float UpDownSpeed = 1;       //漂浮的速度
    public float UpDownDistance = 1;    //漂浮的距離差

    public LayerMask PlayerLayer;        //敵人的Layer
    
    private GameManager.Direction iceMoveDirection = GameManager.Direction.None;
    private float iceSpeed;
    private float addValue = 0;

    /// <summary>
    /// 企鵝跳上浮冰後的控制
    /// </summary>
    /// <param name="_object"></param>
    void OnTriggerEnter(Collider _object)
    {
        if (((1 << _object.gameObject.layer) & this.PlayerLayer.value) > 0)
        {
            _object.GetComponent<TrailRenderer>().enabled = false;      //關閉尾勁特效
            
            _object.transform.parent = this.transform;            
            _object.rigidbody.constraints = RigidbodyConstraints.FreezeRotation | RigidbodyConstraints.FreezePositionX | RigidbodyConstraints.FreezePositionZ;
            
            this.getPenguin = _object.gameObject;
            Invoke("SetKinematic", 1);
        }
    }
    private GameObject getPenguin;
    void SetKinematic()
    {
        this.getPenguin.rigidbody.isKinematic = true;        
    }

    /// <summary>
    /// 設定浮冰的屬性
    /// </summary>
    /// <param name="speed">浮冰移動速度</param>
    /// <param name="direction">浮冰移動的方向</param>
    public void SetIceAttributes(float speed, GameManager.Direction direction)
    {
        this.iceSpeed = speed;
        this.iceMoveDirection = direction;
    }

    void Start()
    {
    }

    // Update is called once per frame
    void Update()
    {
        //控制浮冰的漂浮
        if (this.addValue > this.UpDownDistance)
        {
            this.addValue = this.UpDownDistance;
            this.UpDownSpeed = -this.UpDownSpeed;
        }
        else if (this.addValue < -this.UpDownDistance)
        {
            this.addValue = -this.UpDownDistance;
            this.UpDownSpeed = -this.UpDownSpeed;
        }
        this.addValue += this.UpDownSpeed * Time.deltaTime;
        //------------------------------------------------

        // 控制浮冰的移動
        if (this.iceMoveDirection != GameManager.Direction.None)
        {
            if (this.iceMoveDirection == GameManager.Direction.LeftToRight)
                this.transform.position += ((Vector3.right * this.iceSpeed) + (Vector3.up * this.UpDownSpeed)) * Time.deltaTime;

            else
                this.transform.position -= ((Vector3.right * this.iceSpeed) + (Vector3.up * this.UpDownSpeed)) * Time.deltaTime;
        }
        //------------------------------------------------
    }
}